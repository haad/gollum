GLN Suser server documentation
==============================
Marian Schmotzer <marian.schmotzer@chillisys.com>
v1.0 October 2010:
v1.1 January 2011: Add some firewall description

== General information
|==============================================
|**Procesor** 	   : | 4(8with HT) cores of Intel(R) Xeon(R) CPU X3440  @ 2.53GHz
|**Main memory**    : |	4 Gb	
|**Virtualization** : | N/A	
|**OS**             : | Gentoo linux
|**Device type	    : | server 		
|**State**	   : |in production 
|**SLA**	   : | 24x7 monitoring
|resolve	    | 24 
|Downtime contact  :| Norbert Kyndl
|                   | norbert.kyndl@gln.sk
|                   | +421903796311
|==============================================

**Relations**: None

=== Storage preferences 

|=============================================
|**Raid** : | Raid 1 on all storage, md1(sda1,sdb1), md2(sda2,sdb2),md3(sda3,sdb3)
|**Lvm**  : | Yes
|PV	    | Is on md3
|VG	    | name vg01
|LV	    | LV names: home,usr,tmp,swap,var
|md0	    | /boot
|md1	    | /
|LV home    | /home
|LV usr	    | /usr
|LV tmp     | /tmp
|LV var     | /var
|=============================================

=== Network preferences

|=============================================
|**eth0** : | 
|IP 	    | 193.87.174.100
|MAC 	    | 00:15:17:ed:25:31
|**DNS** :  | suser.uc.gln.sk(external)
|**Special**:| enabled routing via sysctl.conf, MASQUARADE of output trafic
|=============================================

|=============================================
|**eth1** : | 
|IP0 	    | 10.1.14.1
|IP1	    | 10.1.14.2
|MAC 	    | 00:15:17:ed:25:30
|**DNS** :  | suser.uc.gln.sk(internal,to ip 10.1.14.1)
|**Special**:| enabled routing via sysctl.conf, trafic to port 80 forwarded to suser.uc.gln.sk port 3000
|=============================================

=== Installed programs/services


[options="header"]
|=============================================
2+| Squid
|Descr      | Proxy server
|Function   | Caching of web sites from internet
|Components | N/A
|Special    | Listens only on lo
|=============================================

[options="header"]
|=============================================
2+| dansguardian 
|Descr      | Filtering web pages
|Function   | Filters web pages , filtering based on phrases 
|Components | n/a
|Special    | Listens on port 3000 on ip 10.1.14.1
|=============================================

[options="header"]
|=============================================
2+| postfix 
|Descr      | Mail distribution system
|Function   | Sending mail notifications from os, audit and monitoring tools
|Components | n/a
|Special    | Listens only on localhost
|=============================================

[options="header"]
|=============================================
2+| dhcpd 
|Descr | dhcp server
|Function   | assings IP to clients from range 10.1.14.0/24
|Components | n/a
|Special    | Some clients IPs assigned according to client MAC 
|=============================================

[options="header"]
|=============================================
2+| Bind(named)
|Descr | Dns server
|Function   | Resolves DNS names to ip
|Components | n/a
|Special    | Used for internal resolution of names in domain uc.gln.sk(defined in /etc/bind/pri/uc.gln.sk.zone)
|	    | Used for resolution of all DNS names (only internal lan clients)
|=============================================
=== Special

==== Dhcpd
List static of mac to IP maping
////
Generated by:
cat /etc/dhcp/dhcpd.conf | grep -v '#'| grep -A 2 host | sed -e 's/ {$/{/' |tr ' ' '\n' | egrep ';|{'|xargs -n 3|sed -e's/[{;]./|/g; s/;$/|/g; s?^?|?'
////
|========================================
|tlaciaren|00:14:38:9B:6F:80|10.1.14.157
|citacka|00:0B:CD:80:02:D7|10.1.14.125
|agenda|00:11:09:D8:AB:80|10.1.14.161
|obedy|00:44:09:D8:AB:80|10.1.14.162
|obedy2|00:90:C2:DA:9A:3E|10.1.14.163
|kamera1|00:1F:1F:37:36:A7|10.1.14.171
|kamera2|00:1F:1F:37:36:A3|10.1.14.172
|kamera3|00:1F:1F:37:36:AF|10.1.14.173
|kamera4|00:1F:1F:37:36:B6|10.1.14.174
|kamera5|00:1F:1F:37:36:A5|10.1.14.175
|kamera6|00:1F:1F:37:36:A6|10.1.14.176
|kamera7|00:1F:1F:37:36:A0|10.1.14.177
|kamera8|00:1F:1F:37:36:9F|10.1.14.178
|kamera9|00:1F:1F:37:36:CD|10.1.14.179
|kamera10|00:1F:1F:37:36:CE|10.1.14.180
|kamera11|00:1F:1F:37:36:CF|10.1.14.181
|kamera12|00:1F:1F:37:36:D0|10.1.14.182
|kamera13|00:1F:1F:37:36:D1|10.1.14.183
|kamera14|00:1F:1F:37:36:D2|10.1.14.184
|kamera15|00:1F:1F:37:36:CF|10.1.14.185
|=======================================

==== Firewall 
Special firewall rules for proxy. There is some web application which needs to have direct access to 
*glnt.edupage.org*

MARK       tcp  --  anywhere             81.89.49.179.vnet.sk tcp dpt:http MARK set 0xa 
DNAT       tcp  --  anywhere             anywhere            tcp dpt:http mark match !0xa to:10.1.14.1:3000

iptables -v -t nat -I PREROUTING 1 -d glnt.edupage.org -i eth1 -p tcp --dport http -j MARK --set-mark 10
iptables -v -t nat -R PREROUTING 2 -i eth1 -m eth0 -p tcp -m tcp --dport 80 -m mark ! --mark 0xa -j DNAT --to-destination 10.1.14.1:3000
